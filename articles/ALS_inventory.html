<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>ALS competition workflow • TreeCompR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="ALS competition workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TreeCompR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/TreeCompR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ALS_inventory.html">ALS competition workflow</a></li>
    <li><a class="dropdown-item" href="../articles/competition-inventory.html">Quantifying competition from inventory data</a></li>
    <li><a class="dropdown-item" href="../articles/competition-pointcloud.html">Quantifying competition from point cloud data</a></li>
    <li><a class="dropdown-item" href="../articles/TLS_inventory.html">TLS competition workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/juliarieder/TreeCompR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>ALS competition workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/juliarieder/TreeCompR/blob/development/vignettes/ALS_inventory.Rmd" class="external-link"><code>vignettes/ALS_inventory.Rmd</code></a></small>
      <div class="d-none name"><code>ALS_inventory.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="workflow-for-deriving-size-distance-dependent-competition-indizes-from-als-data">Workflow for deriving size-distance-dependent competition indizes
from ALS data<a class="anchor" aria-label="anchor" href="#workflow-for-deriving-size-distance-dependent-competition-indizes-from-als-data"></a>
</h2>
<p>Airborne Laser Scanning is a powerful tool for forest management and
research, offering accurate large-scale data. To quantify competition on
the individual tree level, first the ALS point cloud needs to be
pre-processed. For using the data in TreeCompR, we need to segment the
trees and derive an inventory table. The package <a href="https://CRAN.R-project.org/package=lidR" class="external-link"><code>lidR</code></a> is
a great option to load,inspect and process your ALS data and to segment
individual trees. Check out the <a href="https://r-lidar.github.io/lidRbook/" class="external-link">lidRbook</a> for their very
nice detailed workflows and examples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-lidar/lidR" class="external-link">lidR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://juliarieder.github.io/TreeCompR/">TreeCompR</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="read-the-point-cloud">Read the point cloud<a class="anchor" aria-label="anchor" href="#read-the-point-cloud"></a>
</h2>
<p>The <a href="https://CRAN.R-project.org/package=lidR" class="external-link"><code>lidR</code></a>
package can read various data formats. Read in the raw ALS point cloud.
Here we show a workflow with the example data from the lidR package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">LASfile</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Megaplot.laz"</span>, package<span class="op">=</span><span class="st">"lidR"</span><span class="op">)</span></span>
<span><span class="va">las</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/readLAS.html" class="external-link">readLAS</a></span><span class="op">(</span><span class="va">LASfile</span><span class="op">)</span></span>
<span><span class="co">#print a summary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">las</span><span class="op">)</span></span></code></pre></div>
<p>Maybe just load xyz to save memory, in case you have a lot of
parameters stored in your data, by using the optional parameter
<code>select</code> within <code><a href="https://rdrr.io/pkg/lidR/man/readLAS.html" class="external-link">readLAS()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">las</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/readLAS.html" class="external-link">readLAS</a></span><span class="op">(</span><span class="st">"file.las"</span>, select <span class="op">=</span> <span class="st">"xyz"</span><span class="op">)</span>  <span class="co"># load XYZ only</span></span></code></pre></div>
<p>And it is always good to check and validate your data using the
<code><a href="https://rdrr.io/pkg/lidR/man/las_check.html" class="external-link">las_check()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/las_check.html" class="external-link">las_check</a></span><span class="op">(</span><span class="va">las</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-your-data">Plot your data<a class="anchor" aria-label="anchor" href="#plot-your-data"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">las</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/lidR_plot1.jpg" alt="lidR1" width="500"></p>
<p>Please note, there are various options on individual tree
segmentations (e.g. based on the <a href="https://r-lidar.github.io/lidRbook/itd-its.html#its-cloud" class="external-link">point
cloud</a> or <a href="https://r-lidar.github.io/lidRbook/itd-its.html#its-chm" class="external-link">canopy
height model</a>). Be aware, that based on your own data, you might need
to test the approaches and the results and check visually, if the
results are realistic.</p>
<p>For a segmentation based on CHM, first the CHM needs to be
generated:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create CHM raster from point cloud with 0.5 m resolution (adjust values if needed)</span></span>
<span><span class="va">chm_p2r_05</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/rasterize.html" class="external-link">rasterize_canopy</a></span><span class="op">(</span><span class="va">las</span>, <span class="fl">0.5</span>, <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/dsm_point2raster.html" class="external-link">p2r</a></span><span class="op">(</span>subcircle <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, pkg <span class="op">=</span> <span class="st">"terra"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Post-processing median filter</span></span>
<span><span class="va">kernel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">chm_p2r_05_smoothed</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/focal.html" class="external-link">focal</a></span><span class="op">(</span><span class="va">chm_p2r_05</span>, w <span class="op">=</span> <span class="va">kernel</span>, fun <span class="op">=</span> <span class="va">median</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#locate tree tops</span></span>
<span><span class="va">ttops_chm_p2r_05_smoothed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/locate_trees.html" class="external-link">locate_trees</a></span><span class="op">(</span><span class="va">chm_p2r_05_smoothed</span>, <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/itd_lmf.html" class="external-link">lmf</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">col</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">height.colors</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">chm_p2r_05_smoothed</span>, main <span class="op">=</span> <span class="st">"CHM P2R 0.5 smoothed"</span>, col <span class="op">=</span> <span class="va">col</span><span class="op">)</span>; </span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">ttops_chm_p2r_05_smoothed</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">T</span>, pch <span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/chm_ttops.jpeg" alt="chm" width="500"></p>
</div>
<div class="section level2">
<h2 id="segment-the-trees">Segment the trees<a class="anchor" aria-label="anchor" href="#segment-the-trees"></a>
</h2>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">algo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/its_dalponte2016.html" class="external-link">dalponte2016</a></span><span class="op">(</span><span class="va">chm_p2r_05_smoothed</span>, <span class="va">ttops_chm_p2r_05_smoothed</span><span class="op">)</span></span>
<span><span class="va">las</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/segment.html" class="external-link">segment_trees</a></span><span class="op">(</span><span class="va">las</span>, <span class="va">algo</span><span class="op">)</span> <span class="co"># segment point cloud</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">las</span>, bg <span class="op">=</span> <span class="st">"white"</span>, size <span class="op">=</span> <span class="fl">4</span>, color <span class="op">=</span> <span class="st">"treeID"</span><span class="op">)</span> <span class="co"># visualize trees</span></span></code></pre></div>
<p><img src="../reference/figures/lidR_plot2.jpg" alt="lidR2" width="500"></p>
</div>
<div class="section level2">
<h2 id="get-crown-metrics">Get crown metrics<a class="anchor" aria-label="anchor" href="#get-crown-metrics"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crowns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/aggregate.html" class="external-link">crown_metrics</a></span><span class="op">(</span><span class="va">las</span>, func <span class="op">=</span> <span class="va">.stdtreemetrics</span>, geom <span class="op">=</span> <span class="st">"convex"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">crowns</span><span class="op">[</span><span class="st">"convhull_area"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Crown area (convex hull)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/cpa_ALS.jpeg" alt="cpa" width="500"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/aggregate.html" class="external-link">crown_metrics</a></span><span class="op">(</span><span class="va">las</span>, func <span class="op">=</span> <span class="va">.stdtreemetrics</span>, geom <span class="op">=</span> <span class="st">"point"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trees</span><span class="op">[</span><span class="st">"Z"</span><span class="op">]</span>, main <span class="op">=</span> <span class="st">"Tree heights"</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/heights_ALS.jpeg" alt="heights" width="500"></p>
</div>
<div class="section level2">
<h2 id="integration-into-treecompr">Integration into TreeCompR<a class="anchor" aria-label="anchor" href="#integration-into-treecompr"></a>
</h2>
<p>Extract a inventory table from the crown data:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">inventory</span> <span class="op">&lt;-</span> <span class="va">trees</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_set_geometry</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">inventory</span><span class="op">)</span></span>
<span><span class="co">#&gt;    treeID     Z npoints convhull_area        x       y</span></span>
<span><span class="co">#&gt; 1:     15 18.53      51        19.995 684807.0 5018005</span></span>
<span><span class="co">#&gt; 2:     16 20.66      88        39.888 684838.7 5018006</span></span>
<span><span class="co">#&gt; 3:     17 17.82      73        27.695 684892.5 5018007</span></span>
<span><span class="co">#&gt; 4:     18 13.55      51        23.316 684909.6 5018006</span></span>
<span><span class="co">#&gt; 5:     19 22.00      69        34.506 684770.2 5018006</span></span>
<span><span class="co">#&gt; 6:     20 17.75      28        19.758 684980.1 5018005</span></span></code></pre></div>
<p>validate the inventory table with <code><a href="../reference/read_inv.html">read_inv()</a></code> and define
target trees (automatically) with <code>define_targets()</code> where
trees at the edge of the plot or dataset (1 search radius away from plot
edge) are automatically excluded for calculating CIs.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inv_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_inv.html">read_inv</a></span><span class="op">(</span><span class="va">inventory</span>, height <span class="op">=</span> <span class="va">Z</span>, height_unit <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="co">#&gt; The following columns were used to create the inventory dataset:</span></span>
<span><span class="co">#&gt; id   --- treeID</span></span>
<span><span class="co">#&gt; x    --- x</span></span>
<span><span class="co">#&gt; y    --- y</span></span>
<span><span class="co">#&gt; height   --- Z</span></span>
<span><span class="va">targets_buff</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_target.html">define_target</a></span><span class="op">(</span><span class="va">inv_trees</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, radius <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_target.html">plot_target</a></span><span class="op">(</span><span class="va">targets_buff</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/plot_target_ALS.jpeg" alt="targets" width="500"></p>
<p>Now you can calculate the tree competition (size-distance-dependent)
for your trees. Afterwards you can print your results, save the
dataframe or plot the results according to your needs.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CI</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compete_inv.html">compete_inv</a></span><span class="op">(</span>inv_source <span class="op">=</span> <span class="va">inv_trees</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, </span>
<span>                  radius <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span>
<span><span class="va">CI</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt; 'compete_inv' class inventory with distance-based competition indices </span></span>
<span><span class="co">#&gt; Collection of data for 671 target and 220 edge trees. </span></span>
<span><span class="co">#&gt; Source of target trees: buffer around edge    Search radius: 10 </span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;      id         x          y height CI_Braathe CI_RK3 CI_RK4</span></span>
<span><span class="co">#&gt; 45   61 684895.13 5017995.17  17.44      0.621  3.564   5.29</span></span>
<span><span class="co">#&gt; 50   67 684812.86 5017994.96  24.26      0.494  2.633  4.222</span></span>
<span><span class="co">#&gt; 57   74 684806.23 5017990.75  25.68      1.179  7.868 10.898</span></span>
<span><span class="co">#&gt;     ...       ...        ...    ...        ...    ...    ...</span></span>
<span><span class="co">#&gt; 871 900 684966.93 5017806.91  18.44      0.737  4.914  5.585</span></span>
<span><span class="co">#&gt; 874 903 684975.75 5017803.27     19      0.705  1.173  5.863</span></span>
<span><span class="co">#&gt; 881 910 684959.15 5017797.96  16.03       0.77  3.689  5.311</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-the-results">plot the results<a class="anchor" aria-label="anchor" href="#plot-the-results"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">CI</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, color <span class="op">=</span> <span class="va">CI_Braathe</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Adjust point size and transparency</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"yellow"</span>, high <span class="op">=</span> <span class="st">"darkred"</span>, </span>
<span>                       name <span class="op">=</span> <span class="st">"CI Braathe"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Customizing color scale</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Change the theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Competition based on tree heights and distance"</span>, </span>
<span>       x <span class="op">=</span> <span class="st">"X"</span>, y <span class="op">=</span> <span class="st">"Y"</span><span class="op">)</span> <span class="op">+</span> <span class="co"># Add title and axis labels</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, <span class="co"># Center the plot title</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"right"</span> <span class="co"># Position of the legend</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/CI_Braathe_ALS.jpeg" alt="CIB" width="500"></p>
</div>
<div class="section level2">
<h2 id="other-options-to-pre-process-the-als-point-clouds">Other options to pre-process the ALS point clouds<a class="anchor" aria-label="anchor" href="#other-options-to-pre-process-the-als-point-clouds"></a>
</h2>
<p>There are other packages available, e.g. the <a href="https://rdrr.io/cran/itcSegment/" class="external-link"><code>itcSegment</code></a>
package. Within their function <code>itcLiDARallo()</code>, trees are
being segmented based on typical allometric relations that can be
defined beforehand. We also used this approach with the settings below
to pre-process the MLS data in our manuscript “TreeCompR: Tree
competition indices for inventory data and 3D point clouds”. We used
publicly available laser scanning datasets from the <a href="https://geodaten.bayern.de/opengeodata/OpenDataDetail.html?pn=laserdaten" class="external-link">Bavarian
Agency for Digitisation, High-Speed Internet and Surveying</a>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">itcSegment</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># create a lookup table with common height-crown diameter-relations </span></span>
<span><span class="co"># (example from itcSegment, also used in our case study)</span></span>
<span><span class="va">lut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  H <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">10</span>, <span class="fl">15</span>, <span class="fl">20</span>, <span class="fl">25</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>  CD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#create a digital terrain model</span></span>
<span><span class="va">dtm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/old_spatial_packages.html" class="external-link">grid_terrain</a></span><span class="op">(</span>las <span class="op">=</span> <span class="va">las</span>, res <span class="op">=</span> <span class="fl">0.5</span>, algorithm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lidR/man/dtm_idw.html" class="external-link">knnidw</a></span><span class="op">(</span>k<span class="op">=</span><span class="fl">10L</span>, p<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">dtm</span><span class="op">)</span></span>
<span><span class="co">#normalize the height of the las data by terrain</span></span>
<span><span class="va">nlas</span> <span class="op">&lt;-</span> <span class="va">las</span> <span class="op">-</span> <span class="va">dtm</span></span>
<span></span>
<span><span class="co"># segment the trees (adjust epsg according to your coordinate reference system)</span></span>
<span><span class="va">se</span><span class="op">&lt;-</span><span class="fu">itcLiDARallo</span><span class="op">(</span><span class="va">nlas</span><span class="op">$</span><span class="va">X</span>,<span class="va">nlas</span><span class="op">$</span><span class="va">Y</span>,<span class="va">nlas</span><span class="op">$</span><span class="va">Z</span>,epsg<span class="op">=</span><span class="fl">32632</span>,lut<span class="op">=</span><span class="va">lut</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">se</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/lidR/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">se</span>,axes<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#validate the output in TreeCompR</span></span>
<span><span class="va">inv_trees</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_inv.html">read_inv</a></span><span class="op">(</span><span class="va">se</span>, height <span class="op">=</span> <span class="va">Height_m</span>, height_unit <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="co">#quantify tree competition (adjust radius)</span></span>
<span><span class="fu"><a href="../reference/compete_inv.html">compete_inv</a></span><span class="op">(</span>inv_source <span class="op">=</span> <span class="va">inv_trees</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, </span>
<span>            radius <span class="op">=</span> <span class="fl">13.5</span>, method <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Julia S. Rieder, Roman M. Link.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
