<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TLS competition workflow • TreeCompR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TLS competition workflow">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TreeCompR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/TreeCompR.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/ALS_inventory.html">ALS competition workflow</a></li>
    <li><a class="dropdown-item" href="../articles/competition-inventory.html">Quantifying competition from inventory data</a></li>
    <li><a class="dropdown-item" href="../articles/competition-pointcloud.html">Quantifying competition from point cloud data</a></li>
    <li><a class="dropdown-item" href="../articles/TLS_inventory.html">TLS competition workflow</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/juliarieder/TreeCompR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>TLS competition workflow</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/juliarieder/TreeCompR/blob/development/vignettes/TLS_inventory.Rmd" class="external-link"><code>vignettes/TLS_inventory.Rmd</code></a></small>
      <div class="d-none name"><code>TLS_inventory.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="pre-processing-of-tls-or-mls-point-clouds">Pre-processing of TLS or MLS point clouds<a class="anchor" aria-label="anchor" href="#pre-processing-of-tls-or-mls-point-clouds"></a>
</h2>
<p>For extracting information on tree level from close-range laser
scanning (TLS or MLS), you can use e.g. the <a href="https://www.rdocumentation.org/packages/TreeLS/versions/2.0.2" class="external-link">TreeLS</a>
package. We will show a workflow on how to implement the output of
TreeLS within TreeCompR.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://juliarieder.github.io/TreeCompR/">TreeCompR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">TreeLS</span><span class="op">)</span></span></code></pre></div>
<p>First, load the .las data, normalize the height, sample the point
cloud, estimate tree occurrence regions, classify stem points and
estimate the diameter and height of each individual tree.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">file</span> <span class="op">&lt;-</span> <span class="st">"path/to/file"</span></span>
<span>    <span class="va">tls</span> <span class="op">&lt;-</span> <span class="fu">readTLS</span><span class="op">(</span><span class="va">file</span><span class="op">)</span></span>
<span>    <span class="va">tls_norm</span> <span class="op">&lt;-</span> <span class="fu">tlsNormalize</span><span class="op">(</span><span class="va">tls</span>, keep_ground <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span>    <span class="va">thin</span> <span class="op">&lt;-</span> <span class="fu">tlsSample</span><span class="op">(</span><span class="va">tls_norm</span>, <span class="fu">smp.voxelize</span><span class="op">(</span><span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">treeMap</span><span class="op">(</span><span class="va">thin</span>, <span class="fu">map.hough</span><span class="op">(</span>min_density <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">tls_t</span> <span class="op">&lt;-</span> <span class="fu">treePoints</span><span class="op">(</span><span class="va">tls_norm</span>, <span class="va">map</span>, <span class="fu">trp.crop</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">tls_stem</span> <span class="op">&lt;-</span> <span class="fu">stemPoints</span><span class="op">(</span><span class="va">tls_t</span>, <span class="fu">stm.hough</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">inv</span> <span class="op">&lt;-</span> <span class="fu">tlsInventory</span><span class="op">(</span><span class="va">tls_stem</span>, d_method<span class="op">=</span><span class="fu">shapeFit</span><span class="op">(</span>shape<span class="op">=</span><span class="st">'circle'</span>, </span>
<span>                                                    algorithm <span class="op">=</span> <span class="st">'ransac'</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">inv</span><span class="op">$</span><span class="va">dbh</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">inv</span><span class="op">$</span><span class="va">Radius</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">inv</span><span class="op">)</span></span>
<span><span class="co">#&gt;    TreeID         X          Y     Radius        Error        H h_radius        dbh</span></span>
<span><span class="co">#&gt; 1:      1 12.039168  3.3932670 0.44487714 0.0008539910 24.72817      1.3 0.88975428</span></span>
<span><span class="co">#&gt; 2:      2 11.930523  2.3763304 0.13060774 0.0005245504 24.98053      1.3 0.26121547</span></span>
<span><span class="co">#&gt; 3:      3  7.424479 -4.9563841 0.09487961 0.0003207291 23.75091      1.3 0.18975922</span></span>
<span><span class="co">#&gt; 4:      4  7.144895  5.8221160 0.49786606 0.0004321285 24.05617      1.3 0.99573212</span></span>
<span><span class="co">#&gt; 5:      5  7.085920  0.8309956 0.08171301 0.0002994584 24.07538      1.3 0.16342603</span></span>
<span><span class="co">#&gt; 6:      6  7.183327  5.2498770 0.04965389 0.0004974247 23.94043      1.3 0.09930777    </span></span></code></pre></div>
<p><img src="../reference/figures/TLS_plot3d.JPG" alt="plot_trees3d" width="500"></p>
</div>
<div class="section level2">
<h2 id="use-extracted-tree-information-within-treecompr">Use extracted tree information within TreeCompR<a class="anchor" aria-label="anchor" href="#use-extracted-tree-information-within-treecompr"></a>
</h2>
<p>To ensure that the inventory data is assigned correctly, check the
data and make sure that you specify the units dbh and height if they
differ from the default, which is cm for dbh and m for height. Use
<code><a href="../reference/read_inv.html">read_inv()</a></code> to validate your inventory data within
<code>TreeCompR</code>. To visually check for which trees the CIs will
be quantified depending on the chosen search radius, you can use
<code><a href="../reference/define_target.html">define_target()</a></code> and <code><a href="../reference/plot_target.html">plot_target()</a></code>. We
recommend to use <code>target_source = "buff_edge"</code> to
automatically calculate the CI for all trees in the plot except for
those that are less than one search radius away from the forest edge.
This is specifically important for TLS/MLS data, since these data types
usually only cover small forest plots rather than whole forests.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inventory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_inv.html">read_inv</a></span><span class="op">(</span>inv_source <span class="op">=</span> <span class="va">inv</span>, dbh_unit <span class="op">=</span> <span class="st">"m"</span>, height_unit <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_target.html">define_target</a></span><span class="op">(</span>inv <span class="op">=</span> <span class="va">inventory</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, radius <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/plot_target.html">plot_target</a></span><span class="op">(</span><span class="va">targets</span><span class="op">)</span></span></code></pre></div>
<p><img src="../reference/figures/README-example3-1.png" alt="plot_trees" width="500"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compete_inv.html">compete_inv</a></span><span class="op">(</span><span class="va">inventory</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, radius <span class="op">=</span> <span class="fl">7</span>, </span>
<span>              method <span class="op">=</span> <span class="st">"all_methods"</span><span class="op">)</span></span>
<span><span class="co">#&gt;--------------------------------------------------------------- </span></span>
<span><span class="co">#&gt; 'target_inv' class inventory dataset with defined target trees: </span></span>
<span><span class="co">#&gt; collection of 31 observations </span></span>
<span><span class="co">#&gt; Source of target trees: buffer around edge </span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------</span></span>
<span><span class="co">#&gt;     id      x      y   dbh height target</span></span>
<span><span class="co">#&gt; 1    1 12.039  3.393  0.89 24.728  FALSE</span></span>
<span><span class="co">#&gt; 2    2 11.931  2.376 0.261 24.981  FALSE</span></span>
<span><span class="co">#&gt; 3    3  7.424 -4.956  0.19 23.751  FALSE</span></span>
<span><span class="co">#&gt;    ...    ...    ...   ...    ...    ...</span></span>
<span><span class="co">#&gt; 29  35 -6.407 -4.719  0.06 19.791  FALSE</span></span>
<span><span class="co">#&gt; 30  36 -7.484 -7.635 0.216 22.478  FALSE</span></span>
<span><span class="co">#&gt; 31  38 -5.287  1.051  0.06 22.923  FALSE</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="use-cases">Use cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## If you focus on a specific CI, e.g. the widely used Hegyi-Index, </span></span>
<span><span class="co">## you can choose it within methods = "CI_Hegyi".</span></span>
<span><span class="co">#&gt; compete_inv(inventory, target_source = "buff_edge", radius = 7, </span></span>
<span><span class="co">#&gt;              method = "CI_Hegyi")</span></span>
<span><span class="co">#&gt; The following columns were used to create the inventory dataset:</span></span>
<span><span class="co">#&gt; id   --- TreeID</span></span>
<span><span class="co">#&gt; x    --- X</span></span>
<span><span class="co">#&gt; y    --- Y</span></span>
<span><span class="co">#&gt; dbh  --- dbh</span></span>
<span><span class="co">#&gt; height   --- H</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------- </span></span>
<span><span class="co">#&gt; 'compete_inv' class inventory with distance-based competition indices </span></span>
<span><span class="co">#&gt; Collection of data for 1 target and 30 edge trees. </span></span>
<span><span class="co">#&gt; Source of target trees: buffer around edge    Search radius: 7 </span></span>
<span><span class="co">#&gt; ---------------------------------------------------------------------</span></span>
<span><span class="co">#&gt;    id ...  dbh height CI_Hegyi CI_Braathe CI_RK1 CI_RK2 CI_RK3 CI_RK4</span></span>
<span><span class="co">#&gt; 18 20 ... 0.25   23.9     1.96       2.07   0.49  0.499    4.1   13.2</span></span>
<span></span>
<span><span class="co">## If you have a tree height column that is not automatically recognized within </span></span>
<span><span class="co">## our validation of input data, you can set it manually:</span></span>
<span><span class="co"># in read_inv():</span></span>
<span><span class="va">inventory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_inv.html">read_inv</a></span><span class="op">(</span>inv_source <span class="op">=</span> <span class="va">inventory</span>, height <span class="op">=</span> <span class="st">"h_column_name"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># in compete_inv():</span></span>
<span><span class="fu"><a href="../reference/compete_inv.html">compete_inv</a></span><span class="op">(</span><span class="va">inventory</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, radius <span class="op">=</span> <span class="fl">10</span>, </span>
<span>              height <span class="op">=</span> <span class="st">"h_column_name"</span>, method <span class="op">=</span> <span class="st">"CI_Hegyi"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## If your dbh is specified in cm, just change the dbh_unit to "cm"</span></span>
<span><span class="fu"><a href="../reference/compete_inv.html">compete_inv</a></span><span class="op">(</span><span class="va">inventory</span>, target_source <span class="op">=</span> <span class="st">"buff_edge"</span>, radius <span class="op">=</span> <span class="fl">10</span>, </span>
<span>              dbh_unit <span class="op">=</span> <span class="st">"cm"</span>, method <span class="op">=</span> <span class="st">"CI_Hegyi"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## If you want to keep a column with certain user defined IDs for the trees, </span></span>
<span><span class="co">## and it is not recognized, specify it with id = "name_column"</span></span>
<span><span class="va">inventory</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_inv.html">read_inv</a></span><span class="op">(</span>inv_source <span class="op">=</span> <span class="va">inventory</span>, id <span class="op">=</span> <span class="st">"ID_user"</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Julia S. Rieder, Roman M. Link.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
